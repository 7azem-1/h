<!DOCTYPE html>
<html>
<head>
  <title>حجز ملعب</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js"></script>
  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
</head>
<body>
  <h2>حجز ملعب</h2>
  <form id="bookingForm">
    <!-- بيانات العميل -->
    <input type="text" id="name" placeholder="الاسم" required><br>
    <input type="email" id="email" placeholder="البريد الإلكتروني" required><br>
    <input type="text" id="phone" placeholder="رقم الهاتف" required><br>

    <!-- اختيار اليوم -->
    <label>اختيار اليوم:</label>
    <input type="date" id="date" required><br>

    <!-- اختيار الساعات -->
    <label>من الساعة:</label>
    <select id="from" required>
      <option value="7">7</option>
      <option value="8">8</option>
    </select>

    <label>إلى الساعة:</label>
    <select id="to" required>
      <option value="8">8</option>
      <option value="9">9</option>
    </select>

    <!-- AM / PM -->
    <label>AM / PM:</label>
    <select id="am_pm">
      <option value="AM">AM</option>
      <option value="PM">PM</option>
    </select><br>

    <button type="submit">احجز الآن</button>
  </form>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyChXYUhXG3GliFPb5vp736Hhp7Msllxj68",
    authDomain: "mlaab-city.firebaseapp.com",
    projectId: "mlaab-city",
    storageBucket: "mlaab-city.firebasestorage.app",
    messagingSenderId: "910383180422",
    appId: "1:910383180422:web:3feb8fad61d2cab5917f07",
    measurementId: "G-YQ0016JLVH"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app); // قاعدة البيانات

    emailjs.init("TX8-siv12PBErzriy");

    document.getElementById("bookingForm").addEventListener("submit", async function(e) {
      e.preventDefault();

      // جلب البيانات
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const phone = document.getElementById("phone").value;
      const date = document.getElementById("date").value;
      const from = parseInt(document.getElementById("from").value);
      const to = parseInt(document.getElementById("to").value);
      const am_pm = document.getElementById("am_pm").value;

      if ((to - from) !== 1) {
        alert("مدة الحجز يجب أن تكون ساعة واحدة فقط!");
        return;
      }

      const code = Math.random().toString(36).substring(2, 8).toUpperCase();
      const created_at = new Date().toISOString();

      const data = { name, email, phone, date, from, to, am_pm, code, created_at, expired: false };

      await addDoc(collection(db, "bookings"), data);

      // إرسال الكود عبر الإيميل
      emailjs.send("service_d75wk4a", "template_fo5wwpn", {
        to_email: email,
        name: name,
        code: code,
      }).then(() => {
        alert("تم الحجز! تم إرسال كود إلى البريد.");
      }, (err) => {
        alert("فشل إرسال الإيميل: " + err);
      });
    });
  </script>
</body>
</html>
