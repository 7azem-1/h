<!DOCTYPE html>
<html>
<head>
  <title>ØªØ£ÙƒÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¬Ø²</title>
  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js"></script>
</head>
<body>
  <h2>ØªØ£ÙƒÙŠØ¯ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¬Ø²</h2>
  <input type="text" id="codeInput" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø­Ø¬Ø²">
  <button onclick="checkCode()">ØªØ­Ù‚Ù‚</button>

  <div id="result"></div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
  import { getFirestore } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyChXYUhXG3GliFPb5vp736Hhp7Msllxj68",
    authDomain: "mlaab-city.firebaseapp.com",
    projectId: "mlaab-city",
    storageBucket: "mlaab-city.firebasestorage.app",
    messagingSenderId: "910383180422",
    appId: "1:910383180422:web:3feb8fad61d2cab5917f07",
    measurementId: "G-YQ0016JLVH"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app); // Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª

    async function checkCode() {
      const code = document.getElementById("codeInput").value;
      const q = query(collection(db, "bookings"), where("code", "==", code));
      const querySnapshot = await getDocs(q);

      if (querySnapshot.empty) {
        document.getElementById("result").innerText = "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.";
        return;
      }

      querySnapshot.forEach(docSnap => {
        const data = docSnap.data();
        if (data.expired) {
          document.getElementById("result").innerText = "âŒ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ§Ù„Ø­ (ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡).";
        } else {
          document.getElementById("result").innerHTML = `
            âœ… Ø§Ù„Ø§Ø³Ù…: ${data.name}<br>
            ğŸ“ Ø§Ù„Ù‡Ø§ØªÙ: ${data.phone}<br>
            ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®: ${data.date}<br>
            ğŸ•’ Ø§Ù„ÙˆÙ‚Øª: ${data.from}-${data.to} ${data.am_pm}<br>
            <button onclick="expireCode('${docSnap.id}')">ØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯</button>
          `;
        }
      });
    }

    async function expireCode(docId) {
      const bookingRef = doc(db, "bookings", docId);
      await updateDoc(bookingRef, { expired: true });
      alert("âœ… ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙƒÙˆØ¯.");
      document.getElementById("result").innerText = "âŒ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø¢Ù† ØºÙŠØ± ØµØ§Ù„Ø­.";
    }
  </script>
</body>
</html>
